<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cine Arena.live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Latest Shaka Player UI v4.16.3 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.3/controls.css" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.16.3/shaka-player.ui.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    :root {
      --primary: #33ccff;
      --primary-2: #0099cc;
      --bg: #000;
      --text: #fff;
      --content-bg: rgba(0, 0, 0, 0.8);
      --header-bg: linear-gradient(90deg, #33ccff, #0099cc);
    }
    
    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f5f5f5;
        --text: #333;
        --content-bg: rgba(255, 255, 255, 0.8);
        --header-bg: linear-gradient(90deg, #33ccff, #0099cc);
      }
      
      body {
        color: var(--text);
      }
      
      .content-section {
        background: var(--content-bg);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      .content-title {
        background: linear-gradient(90deg, rgba(51, 204, 255, 0.3), rgba(0, 153, 204, 0.2));
      }
      
      .note {
        color: #666;
      }
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      min-height: 100vh;
      padding: 12px;
      overflow-x: hidden;
      position: relative;
    }

    /* Header */
    .site-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 1200;
      background: var(--header-bg);
      box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    }
    
    .site-brand {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .site-title {
      font-weight: 800;
      letter-spacing: 0.4px;
      color: #fff;
      font-size: 22px;
    }
    
    .site-sub {
      font-size: 12px;
      opacity: 0.95;
      color: #eafaff;
      margin-top: 4px;
    }
    
    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    
    .tg-btn {
      background: rgba(255,255,255,0.08);
      padding: 10px 16px;
      border-radius: 10px;
      color: #fff;
      text-decoration: none;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.04);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tg-btn:hover {
      background: rgba(255,255,255,0.15);
      border-radius: 10px;
    }
    
    .tg-btn i {
      font-size: 20px;
    }

    /* Main Container */
    .main-container {
      max-width: 1400px;
      margin: 70px auto 0;
      padding: 20px;
      display: flex;
      gap: 30px;
    }

    /* Video Section */
    .video-section {
      flex: 3;
      display: flex;
      flex-direction: column;
    }

    .video-container {
      border-radius: 12px;
      width: 100%;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6), 0 4px 15px rgba(0,0,0,0.4) inset;
      background: black;
      position: relative;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      height: 0;
    }
    
    #video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 12px;
    }
    
    .player-logo {
      position: absolute;
      top: 15px;
      left: 20px;
      max-width: 120px;
      max-height: 30px;
      transition: opacity 1s ease;
      opacity: 0;
      pointer-events: none;
      z-index: 20;
    }

    /* Content Section - IMPROVED DESIGN */
    .content-section {
      flex: 2;
      background: linear-gradient(135deg, rgba(51, 204, 255, 0.1), rgba(0, 153, 204, 0.05));
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.05);
      height: fit-content;
      backdrop-filter: blur(10px);
    }
    
    .content-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--primary);
      text-align: center;
      padding: 15px;
      background: linear-gradient(90deg, rgba(51, 204, 255, 0.2), rgba(0, 153, 204, 0.1));
      border-radius: 10px;
      border-left: 4px solid var(--primary);
    }
    
    .content-list {
      list-style-type: none;
      margin-bottom: 25px;
    }
    
    .content-list li {
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      background: linear-gradient(135deg, rgba(51, 204, 255, 0.15), rgba(0, 153, 204, 0.08));
      margin-bottom: 15px;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }
    
    .content-list li:hover {
      background: linear-gradient(135deg, rgba(51, 204, 255, 0.25), rgba(0, 153, 204, 0.15));
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .content-list li:last-child {
      margin-bottom: 0;
    }
    
    .content-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: bold;
      display: block;
      font-size: 20px;
      transition: all 0.3s ease;
    }
    
    .content-link:hover {
      color: #fff;
      text-decoration: none;
    }
    
    .note {
      font-size: 15px;
      color: #aaa;
      margin-top: 8px;
      font-style: italic;
      display: block;
    }
    
    .social-section {
      margin: 25px 0;
      text-align: center;
    }
    
    .social-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
    }
    
    .social-icons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .social-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 22px;
      color: white;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: relative;
    }
    
    .social-icon:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    }
    
    .whatsapp {
      background: #25D366;
    }
    
    .telegram {
      background: #0088cc;
    }
    
    .facebook {
      background: #3b5998;
    }
    
    .instagram {
      background: #E1306C;
    }

    .share-btn {
      background: linear-gradient(135deg, #33ccff, #0099cc);
      border: none;
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(51, 204, 255, 0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 20px auto 0;
    }
    
    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(51, 204, 255, 0.4);
      background: linear-gradient(135deg, #33ccff, #0099cc);
    }
    
    .share-btn:active {
      transform: translateY(0);
    }

    /* Modal */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.6);
      z-index: 1300;
      visibility: hidden;
      opacity: 0;
      transition: all 220ms cubic-bezier(.2,.9,.2,1);
    }
    
    .modal.show {
      visibility: visible;
      opacity: 1;
    }
    
    .modal-card {
      width: min(94%, 480px);
      border-radius: 14px;
      padding: 24px 18px;
      position: relative;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      background: rgba(102, 102, 102,0.8);
      border: 1px solid rgba(255,255,255,0.03);
      text-align: center;
      color: #fff;
    }
    
    .modal-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      color: #fff;
    }
    
    .modal-title i {
      font-size: 28px;
      color: #33ccff;
    }
    
    .modal-card h3 {
      font-size: 22px;
      margin: 0;
      color: #ffcc00;
    }

    #joinChannel {
      background: linear-gradient(145deg, #2aabee, #229ed9);
      color: white;
      box-shadow: 0 6px 15px rgba(42, 171, 238, 0.3);
      border: 2px solid rgba(38, 38, 38,0.60);
    }

    #joinChannel:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(42, 171, 238, 0.4),
                  inset 0 0 15px rgba(255,255,255,0.2);
    }

    #joinChannel::before {
      content: '';
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.72 8.141l-1.919 9.078c-.134.613-.515.764-1.039.476l-2.865-2.103-1.378 1.3c-.181.181-.335.335-.658.335l.236-3.053 5.272-4.757c.217-.196-.049-.306-.348-.11l-6.552 4.128-2.821-.881c-.613-.191-.629-.613.133-.914l11.02-4.242c.5-.174.939.119.759.917z"/></svg>');
      width: 22px;
      height: 22px;
      background-size: contain;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
      transition: transform 0.3s ease;
    }

    #joinChannel:hover::before {
      transform: scale(1.1) rotate(-5deg);
    }

    #alreadyJoined {
      background: rgba(38, 38, 38,0.95);
      color: #000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: 2px solid #229ed9;
      backdrop-filter: blur(4px);
    }

    #alreadyJoined:hover {
      background: rgba(255,255,255,1);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(34, 158, 217, 0.2);
    }

    #alreadyJoined::after {
      content: 'âœ“';
      font-weight: 700;
      margin-left: 8px;
      transform: scale(1.2);
      opacity: 0.8;
    }

    /* Loading animation */
    @keyframes buttonGlow {
      0% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    #joinChannel:active {
      transform: scale(0.98);
      box-shadow: 0 3px 10px rgba(42, 171, 238, 0.2);
    }

    #closeModal {
      position: absolute;
      top: 15px;
      right: 20px;
      color: #33ccff;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s ease;
    }

    #closeModal:hover {
      opacity: 1;
    }
    
    .close-x {
      position: absolute;
      right: 12px;
      top: 10px;
      font-size: 20px;
      color: rgba(255,255,255,0.7);
      cursor: pointer;
    }
    
    /* Error Message */
    .error-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px;
      border-radius: 12px;
      text-align: center;
      z-index: 1400;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,0,0,0.3);
      max-width: 90%;
      width: 400px;
    }
    
    .error-message h3 {
      color: #ff5555;
      margin-bottom: 15px;
      font-size: 22px;
    }
    
    .error-message p {
      margin-bottom: 20px;
      font-size: 16px;
      line-height: 1.5;
    }
    
    .error-countdown {
      font-weight: bold;
      color: #33ccff;
      font-size: 18px;
    }

    /* Hide Shaka spinner */
    .shaka-spinner-container {
      display: none !important;
    }

    /* CRITICAL FIX: Fullscreen video styling */
    .video-container:fullscreen,
    .video-container:-webkit-full-screen {
      width: 100% !important;
      height: 100% !important;
      padding: 0 !important;
      border-radius: 0 !important;
      background: #000 !important;
    }

    .video-container:fullscreen #video,
    .video-container:-webkit-full-screen #video {
      object-fit: contain !important;
      border-radius: 0 !important;
    }

    /* CRITICAL FIX: Ensure Shaka controls are visible in fullscreen */
    .shaka-video-container:fullscreen .shaka-controls-container,
    .shaka-video-container:-webkit-full-screen .shaka-controls-container {
      display: flex !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }
    }
    
    @media (max-width: 768px) {
      .site-header {
        padding: 0 15px;
        height: 60px;
      }
      
      .site-title {
        font-size: 18px;
      }
      
      .site-sub {
        font-size: 10px;
      }
      
      .tg-btn {
        padding: 8px 12px;
        font-size: 14px;
      }
      
      .main-container {
        margin-top: 60px;
        padding: 15px;
        gap: 20px;
      }
      
      .content-section {
        padding: 20px;
      }
      
      .content-link {
        font-size: 18px;
      }
      
      .note {
        font-size: 13px;
      }
      
      .player-logo {
        max-width: 90px;
        max-height: 22px;
        top: 10px;
        left: 15px;
      }
      
      .social-icons {
        gap: 10px;
      }
      
      .social-icon {
        width: 45px;
        height: 45px;
        font-size: 20px;
      }
      
      .modal-card p {
        font-size: 15px;
      }
      
      #closeModal {
        top: 1px;
        right: 10px;
      }
      
      /* Mobile fullscreen fixes */
      .video-container:fullscreen .player-logo,
      .video-container:-webkit-full-screen .player-logo {
        max-width: 80px;
        max-height: 20px;
        top: 15px;
        left: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .site-header {
        height: 55px;
      }
      
      .site-title {
        font-size: 16px;
      }
      
      .site-sub {
        font-size: 9px;
      }
      
      .tg-btn {
        padding: 6px 10px;
        font-size: 12px;
      }
      
      .main-container {
        margin-top: 45px;
        padding: 10px;
        gap: 15px;
      }
      
      .content-section {
        padding: 15px;
      }
      
      .content-title {
        font-size: 20px;
      }
      
      .player-logo {
        max-width: 80px;
        max-height: 20px;
        top: 8px;
        left: 10px;
      }
      
      .social-icons {
        gap: 8px;
      }
      
      .social-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
      
      .share-btn {
        padding: 10px 20px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="site-brand">
      <div class="site-title">Cine Arena</div>
      <div class="site-sub">Thank you for watching</div>
    </div>
    <div class="header-actions">
      <a class="tg-btn" href="https://t.me/cine_arena" target="_blank" rel="noopener">
        <i class="material-icons">telegram</i> Join Telegram
      </a>
    </div>
  </header>

  <div class="main-container">
    <div class="video-section">
      <div class="video-container shaka-video-container no-cursor" data-shaka-player-container="" shaka-controls="true">
        <video id="video" data-shaka-player="" autoplay="" muted="" preload="auto" playsinline="" class="shaka-video">
          <source src="blob:https://sklink.pages.dev/3a42efd2-21b0-4496-b926-fa59ee976713" type="">
        </video>
        <img class="player-logo" src="https://i.postimg.cc/1tTSCPTX/jwf.png" alt="logo" style="opacity: 0; pointer-events: none;">
      </div>
    </div>
    
    <div class="content-section">
      <div class="content-title">Follow us for Updates!</div>
      
      <ul class="content-list">
        <li>
          <a href="https://t.me/sk_cricinfo" class="content-link" target="_blank">Join Telegram For More Links</a>
          <span class="note">Copy Link &amp; Open in Chrome Browser Only</span>
        </li>
      </ul>
      
      <div class="social-section">
        <div class="social-title">Share This Page Link:</div>
        <div class="social-icons">
          <a href="#" class="social-icon whatsapp" title="Share on WhatsApp">
            <i class="fab fa-whatsapp"></i>
          </a>
          <a href="#" class="social-icon telegram" title="Share on Telegram">
            <i class="fab fa-telegram"></i>
          </a>
          <a href="#" class="social-icon facebook" title="Share on Facebook">
            <i class="fab fa-facebook-f"></i>
          </a>
          <a href="#" class="social-icon instagram" title="Share on Instagram">
            <i class="fab fa-instagram"></i>
          </a>
        </div>
        
        <!-- Share Button -->
        <button class="share-btn" id="sharePageBtn">
          <i class="fas fa-share-alt"></i>
          Share This Page Link
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="skpop" class="modal" aria-hidden="true" role="dialog">
    <div class="modal-card">
      <div class="close-x" id="closeModal" title="close">Ã—</div>
      <div class="modal-title">
        <i class="material-icons">telegram</i>
        <h3>Join Our Telegram Channel</h3>
      </div>
      <p>Get instant cricket updates, exclusive videos, Breaking News, and link updates. Join Cine Arena on Telegram to stay informed!</p>
      <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
        <button id="joinChannel" class="btn-join" style="padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer;color:#fff;background:linear-gradient(90deg,#33ccff,#0099cc)">Join Now</button>
        <button id="alreadyJoined" class="btn-muted" style="padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer;color:#fff;background:rgba(255,255,255,0.09)">I'm Already a Member</button>
      </div>
    </div>
  </div>

  <script>
    // Function to show invalid ID message and redirect
    function showInvalidIdMessage() {
      // Create error message element
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.innerHTML = `
        <h3>Invalid Stream ID</h3>
        <p>Sorry, the stream you're trying to access is not available or the ID is incorrect.</p>
        <p>Redirecting to our Telegram channel in <span class="error-countdown">5</span> seconds...</p>
      `;
      
      document.body.appendChild(errorDiv);
      
      // Countdown and redirect
      let countdown = 5;
      const countdownElement = errorDiv.querySelector('.error-countdown');
      
      const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
          window.location.href = 'https://t.me/cine_arena';
        }
      }, 1000);
    }

    // Modal functionality
    (function(){
      const modal = document.getElementById('skpop');
      const closeBtn = document.getElementById('closeModal');
      const joinBtn = document.getElementById('joinChannel');
      const alreadyBtn = document.getElementById('alreadyJoined');
      
      function showModal(){ 
        modal.classList.add('show'); 
        modal.setAttribute('aria-hidden','false'); 
      }
      
      function hideModal(){ 
        modal.classList.remove('show'); 
        modal.setAttribute('aria-hidden','true'); 
      }
      
      closeBtn.addEventListener('click', hideModal);
      alreadyBtn.addEventListener('click', hideModal);
      joinBtn.addEventListener('click', function(){ 
        window.open('https://t.me/cine_arena','_blank'); 
        hideModal(); 
      });
      
      setTimeout(showModal, 700);
    })();

    // Social media sharing functionality
    document.addEventListener('DOMContentLoaded', function() {
      const currentUrl = encodeURIComponent(window.location.href);
      const pageTitle = encodeURIComponent("Cine Arena ðŸ Watch Now!");
      const shareText = encodeURIComponent("ðŸš¨ LIVE CRICKET STREAMING ðŸš¨\n\nWatch Cine Arena live stream now!\n\n");
      
      // WhatsApp
      document.querySelector('.social-icon.whatsapp').addEventListener('click', function(e) {
        e.preventDefault();
        window.open(`https://api.whatsapp.com/send?text=${shareText}${currentUrl}`, '_blank');
      });
      
      // Telegram
      document.querySelector('.social-icon.telegram').addEventListener('click', function(e) {
        e.preventDefault();
        window.open(`https://t.me/share/url?url=${currentUrl}&text=${shareText}`, '_blank');
      });
      
      // Facebook
      document.querySelector('.social-icon.facebook').addEventListener('click', function(e) {
        e.preventDefault();
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${currentUrl}&quote=${shareText}`, '_blank');
      });
      
      // Instagram (can't share directly, so open in new tab)
      document.querySelector('.social-icon.instagram').addEventListener('click', function(e) {
        e.preventDefault();
        window.open('https://www.instagram.com/', '_blank');
      });

      // Share Button functionality
      document.getElementById('sharePageBtn').addEventListener('click', function() {
        const shareData = {
          title: 'SK CRIC INFO',
          text: 'Watch SK CRIC INFO live stream now!',
          url: window.location.href
        };

        if (navigator.share) {
          navigator.share(shareData)
            .then(() => console.log('Shared successfully'))
            .catch((error) => console.log('Error sharing:', error));
        } else {
          // Fallback: Copy to clipboard
          navigator.clipboard.writeText(window.location.href)
            .then(() => {
              alert('Stream link copied to clipboard! ðŸ“‹\n\nShare it with your friends to watch together!');
            })
            .catch(() => {
              // Fallback for older browsers
              const tempInput = document.createElement('input');
              tempInput.value = window.location.href;
              document.body.appendChild(tempInput);
              tempInput.select();
              document.execCommand('copy');
              document.body.removeChild(tempInput);
              alert('Stream link copied to clipboard! ðŸ“‹\n\nShare it with your friends to watch together!');
            });
        }
      });
    });

    // Shaka Player initialization - Now with PiP button
    (async function(){
      try {
        // Check for invalid ID immediately
        const params = new URLSearchParams(window.location.search);
        const idParam = params.get('id');
        
        // If no ID parameter or ID is explicitly invalid, show error immediately
        if (!idParam || idParam === 'invalid') {
          showInvalidIdMessage();
          return;
        }

        // Wait for Shaka to be available
        if (typeof shaka === 'undefined') {
          console.error('Shaka Player not loaded');
          return;
        }

        shaka.polyfill.installAll();
        
        if (!shaka.Player.isBrowserSupported()) {
          console.warn('Shaka not supported');
          return;
        }

        const video = document.getElementById('video');
        const container = document.querySelector('[data-shaka-player-container]');
        
        if (!video || !container) {
          console.error('Video element or container not found');
          return;
        }

        const player = new shaka.Player(video);
        const ui = new shaka.ui.Overlay(player, container, video);
        
        // Configure UI with Picture-in-Picture button
        const uiConfig = {
          controlPanelElements: [
            'play_pause',
            'mute',
            'volume',
            'time_and_duration',
            'spacer',
            'picture_in_picture',
            'overflow_menu',
            'fullscreen'
          ],
          addSeekBar: true,
          seekBarColors: {
            base: 'rgba(255, 255, 255, 0.3)',
            buffered: 'rgba(255, 255, 255, 0.5)',
            played: 'rgba(51, 204, 255, 0.9)',
          },
          volumeBarColors: {
            base: 'rgba(255, 255, 255, 0.3)',
            level: 'rgba(51, 204, 255, 0.9)',
          }
        };

        // Apply UI configuration
        ui.configure(uiConfig);

        // Simple player configuration
        player.configure({
          streaming: {
            bufferingGoal: 30
          }
        });

        // fetch-based loader
        const _cache = new Map();
        async function fetchStreamData(id){
          const key = `stream-${id}`;
          const c = _cache.get(key);
          if(c && Date.now()-c.ts < 3e5) return c.val;
          try{
            const controller = new AbortController();
            const timeout = setTimeout(()=>controller.abort(), 3000); // Reduced timeout
            const res = await fetch('https://sktechapi.saqlainhaider8198.workers.dev', { signal: controller.signal });
            clearTimeout(timeout);
            if(!res.ok) throw new Error('API status:'+res.status);
            const json = await res.json();
            const item = (json.data||[]).find(i=>String(i.id)===String(id));
            _cache.set(key, { val:item||null, ts:Date.now() });
            return item||null;
          }catch(err){ 
            console.error('Fetch error', err); 
            return null; 
          }
        }

        const manifestParam = params.get('manifest');

        let payload = null;
        if(manifestParam){ 
          payload = { manifest: manifestParam, title: 'Manual manifest' }; 
        } else { 
          payload = await fetchStreamData(idParam); 
        }

        if(!payload){ 
          console.warn('Unable to fetch stream metadata.');
          showInvalidIdMessage();
          return; 
        }

        const manifestUrl = payload.mpdLink || payload.manifest || payload.url || payload.stream || payload.hls || payload.manifestUrl || null;
        const clearkey = payload.clearkey || payload.clearkeys || payload.i || payload.clearKeys || payload.keys || {};

        if(clearkey && (clearkey.keyId || clearkey.key_id) && (clearkey.key || clearkey.keyvalue)){
          try{ 
            const kid = clearkey.keyId || clearkey.key_id; 
            const key = clearkey.key || clearkey.keyvalue; 
            const ck = {}; 
            ck[kid] = key; 
            player.configure({ drm: { clearKeys: ck } }); 
            console.info('Configured clearKeys'); 
          } catch(e){ 
            console.warn('clearKey config failed', e); 
          }
        }

        if(!manifestUrl){ 
          console.warn('Payload did not include a valid manifest URL.');
          showInvalidIdMessage();
          return; 
        }

        async function tryLoad(url, attempts=1){ // Reduced attempts
          for(let i=0; i<=attempts; i++){ 
            try{ 
              await player.load(url); 
              console.info('Loaded manifest:', url); 
              return true; 
            } catch(err){ 
              console.warn('Load attempt '+(i+1)+' failed', err); 
              if(i===attempts) return false; 
              await new Promise(r => setTimeout(r, 500)); // Reduced delay
            } 
          } 
          return false; 
        }

        const ok = await tryLoad(manifestUrl, 1); // Only one attempt
        
        if(!ok){ 
          console.warn('Failed to load stream.');
          showInvalidIdMessage();
          return; 
        }

        // Logo show/hide behavior
        (function(){
          const logo = document.querySelector('.player-logo');
          if(!logo) return;
          
          let showTimer = null; 
          let hoverReady = false;
          
          const initialDelay = 1500;
          
          function hideLogo(){ 
            logo.style.opacity = '0'; 
            logo.style.pointerEvents = 'none'; 
          }
          
          function showLogo(){ 
            logo.style.opacity = '1'; 
            logo.style.pointerEvents = 'auto'; 
            if(showTimer) clearTimeout(showTimer); 
            showTimer = setTimeout(() => { hideLogo(); }, 3000); 
          }
          
          setTimeout(() => { 
            hoverReady = true; 
            showLogo(); 
          }, initialDelay);
          
          const containerEl = document.querySelector('.video-container');
          if(containerEl){ 
            containerEl.addEventListener('mousemove', function(){ 
              if(hoverReady) showLogo(); 
            }, { passive:true }); 
            
            containerEl.addEventListener('mouseleave', function(){ 
              if(hoverReady) hideLogo(); 
            }, { passive:true }); 
          }
        })();

        player.addEventListener('error', function(ev){ 
          console.error('Shaka error', ev); 
        });

      } catch(e){ 
        console.error('Shaka init failed', e); 
        showInvalidIdMessage();
      }
    })();
  </script>
</body>
</html>
